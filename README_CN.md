# POMA 2.0 ä½¿ç”¨æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

POMA (Product Operator Formalism) æ˜¯ä¸€ä¸ªç”¨äº NMR è„‰å†²åºåˆ—ä»¿çœŸçš„ Mathematica åŒ…ã€‚æœ¬é¡¹ç›®å·²é…ç½®å¥½é€šè¿‡æ¸…åå¤§å­¦è®¸å¯è¯æœåŠ¡å™¨è¿è¡Œã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. æ¿€æ´» conda ç¯å¢ƒ

```bash
conda activate wolfram
```

### 2. è¿è¡Œæ–¹å¼

#### æ–¹å¼ A: äº¤äº’å¼è¯¦ç»†ç‰ˆï¼ˆæ¨èï¼‰

```bash
cd /home/tony/NMRAI/poma-2.0
python run_poma_interactive.py
```

**ç‰¹ç‚¹:**
- âœ… æ˜¾ç¤ºæ¯ä¸€æ­¥çš„è¯¦ç»†è¾“å…¥è¾“å‡º
- âœ… å¯è§†åŒ–è„‰å†²åºåˆ—æµç¨‹
- âœ… æ”¯æŒå¤šç§é¢„è®¾ç¤ºä¾‹

#### æ–¹å¼ B: ç¾åŒ–ç‰ˆ

```bash
python run_poma_beautiful.py
```

**ç‰¹ç‚¹:**
- âœ… ä½¿ç”¨ Unicode ç¬¦å·ç¾åŒ–è¾“å‡º
- âœ… æ›´ç®€æ´çš„æ˜¾ç¤ºæ ¼å¼
- âœ… é€‚åˆå¿«é€ŸæŸ¥çœ‹ç»“æœ

#### æ–¹å¼ C: ç›´æ¥ä½¿ç”¨ Wolfram

```bash
WolframKernel -run run_poma.wls
```

## ğŸ“š å¯ç”¨ç¤ºä¾‹

### ç¤ºä¾‹ 1: ç®€å•çš„ 90Â° è„‰å†²

```
åˆå§‹çŠ¶æ€: I1z
90Â° x è„‰å†² â†’ -I1y
å»¶è¿Ÿ â†’ æ¼”åŒ–åçš„è‡ªæ—‹æ€
```

### ç¤ºä¾‹ 2: HSQC åºåˆ—

**å¼‚æ ¸å•é‡å­ç›¸å¹² (Heteronuclear Single Quantum Coherence)**

å‚æ•°:
- Jâ‚â‚‚ = 140 Hz (1H-X è€¦åˆå¸¸æ•°)
- Ï‰â‚  = 500 MHz (1H é¢‘ç‡)
- Ï‰â‚‚  = 50 MHz (X æ ¸é¢‘ç‡)

åºåˆ—:
```
I1z I2z
  â†“ 90Â°x (Â¹H)
-I1y I2z
  â†“ Ï„ = 1/(4J) = 1.79 ms
æ¼”åŒ– (åŒ–å­¦ä½ç§» + J è€¦åˆ)
  â†“ 180Â°x (æ‰€æœ‰è‡ªæ—‹)
é‡èšç„¦
  â†“ Ï„ = 1/(4J) = 1.79 ms
æ¼”åŒ–
  â†“ 90Â°y (X æ ¸)
-I1y I2x
```

### ç¤ºä¾‹ 3: COSY åºåˆ—

**åŒæ ¸ç›¸å…³è°± (Correlation Spectroscopy)**

å‚æ•°:
- Jâ‚â‚‚ = 10 Hz (åŒæ ¸è€¦åˆ)
- Ï‰â‚ = Ï‰â‚‚ = 500 MHz

åºåˆ—:
```
90Â° - tâ‚ - 90Â° - é‡‡é›†
```

## ğŸ”§ è‡ªå®šä¹‰åºåˆ—

åœ¨ Python ä¸­å®šä¹‰è‡ªå·±çš„åºåˆ—:

```python
from run_poma_interactive import NMRSimulator

sim = NMRSimulator()
sim.connect()

# è®¾ç½®å‚æ•°
sim.set_parameters({
    'j[1,2]': 10,
    'w[1]': 500,
})

# å®šä¹‰åºåˆ—æ­¥éª¤
my_steps = [
    ("90åº¦è„‰å†²", "pulse[90, x]"),
    ("å»¶è¿Ÿ", "delay[0.01]"),
    ("180åº¦è„‰å†²", "pulse[180, y]"),
]

# è¿è¡Œ
sim.run_sequence('spin[1,z]', my_steps)
sim.get_observable()
sim.disconnect()
```

## ğŸ“– POMA å‘½ä»¤å‚è€ƒ

### åŸºæœ¬å‘½ä»¤

| å‘½ä»¤ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `spin[n,k]` | è‡ªæ—‹ç®—å­ | `spin[1,x]` â†’ I1x |
| `pulse[angle,phase,spins]` | RF è„‰å†² | `pulse[90,x,{1}]` |
| `delay[time,couplings]` | å»¶è¿Ÿæ¼”åŒ– | `delay[0.1,{{1,2}}]` |
| `j[n,m]` | è€¦åˆå¸¸æ•° | `j[1,2]=140` |
| `w[n]` | æ‹‰è«å°”é¢‘ç‡ | `w[1]=500` |
| `observable[]` | å¯è§‚æµ‹ç£åŒ– | `observable[sigma]` |
| `raiselower[]` | è½¬å‡é™ç®—ç¬¦ | `raiselower[sigma]` |

### è„‰å†²ç›¸ä½

- `x`, `y`, `z`: ç¬›å¡å°”åæ ‡è½´
- æ•°å­—: è§’åº¦ï¼ˆåº¦ï¼‰
- `pulse[90,x]`: 90 åº¦ x è„‰å†²
- `pulse[180,y]`: 180 åº¦ y è„‰å†²

### ä½œç”¨èŒƒå›´

- `{1}`: ä»…ä½œç”¨äºè‡ªæ—‹ 1
- `{1,2}`: ä½œç”¨äºè‡ªæ—‹ 1 å’Œ 2
- çœç•¥: ä½œç”¨äºæ‰€æœ‰è‡ªæ—‹

### å»¶è¿Ÿæ¼”åŒ–

```wolfram
delay[t]                          # ä»…åŒ–å­¦ä½ç§»
delay[t, {{1,2}}]                # åŒ–å­¦ä½ç§» + J è€¦åˆ
delay[t, {{1,2}}, {1}]          # ä»… 1 æœ‰åŒ–å­¦ä½ç§»
```

## ğŸ“‚ é¡¹ç›®æ–‡ä»¶

```
poma-2.0/
â”œâ”€â”€ Poma2.m              # ä¸»åŒ…æ–‡ä»¶
â”œâ”€â”€ 3QF-COSY.m          # 3é‡å­è¿‡æ»¤ COSY ç¤ºä¾‹
â”œâ”€â”€ HSQC.m              # HSQC ç¤ºä¾‹ï¼ˆç›¸ä½å¾ªç¯ï¼‰
â”œâ”€â”€ HSQCgrad.m          # HSQC ç¤ºä¾‹ï¼ˆæ¢¯åº¦ï¼‰
â”œâ”€â”€ run_poma.wls         # Wolfram è„šæœ¬
â”œâ”€â”€ run_poma.py          # åŸºç¡€ Python è„šæœ¬
â”œâ”€â”€ run_poma_v2.py      # Python wolframclient ç‰ˆ
â”œâ”€â”€ run_poma_interactive.py  # äº¤äº’å¼è¯¦ç»†ç‰ˆ â˜…
â”œâ”€â”€ run_poma_beautiful.py    # ç¾åŒ–ç‰ˆ â˜…
â””â”€â”€ README_CN.md         # æœ¬æ–‡æ¡£
```

## ğŸŒ ç½‘ç»œè®¸å¯è¯

å·²é…ç½®æ¸…åå¤§å­¦è®¸å¯è¯æœåŠ¡å™¨:

**æœåŠ¡å™¨:** `mathematica.tsinghua.edu.cn`

é…ç½®æ–‡ä»¶: `~/.Wolfram/Licensing/mathpass`
```
!mathematica.tsinghua.edu.cn
```

## ğŸ’¡ ä½¿ç”¨æŠ€å·§

1. **æŸ¥çœ‹å¸®åŠ©**: åœ¨ Wolfram ä¸­è¾“å…¥ `?commands`
2. **å…·ä½“å‘½ä»¤**: `?pulse` æŸ¥çœ‹ pulse è¯¦ç»†è¯´æ˜
3. **è°ƒè¯•**: ä½¿ç”¨ `show["æ ‡ç­¾"]` åœ¨åºåˆ—ä¸­æ’å…¥æ£€æŸ¥ç‚¹
4. **å­˜å‚¨**: `store[å˜é‡å]` ä¿å­˜ä¸­é—´çŠ¶æ€

## ğŸ“š å‚è€ƒèµ„æ–™

- POMA åŸå§‹è®ºæ–‡: GÃ¼ntert et al., J. Magn. Reson. A 101, 103-105 (1993)
- Mathematica æ–‡æ¡£: https://reference.wolfram.com/

## ğŸ› æ•…éšœæ’é™¤

### è®¸å¯è¯é”™è¯¯
```bash
# æ£€æŸ¥ mathpass æ–‡ä»¶
cat ~/.Wolfram/Licensing/mathpass
# åº”æ˜¾ç¤º: !mathematica.tsinghua.edu.cn
```

### è·¯å¾„é”™è¯¯
```bash
# é‡æ–°åŠ è½½é…ç½®
source ~/.zshrc
# éªŒè¯
which WolframKernel
```

### è¿æ¥è¶…æ—¶
ç¡®ä¿ç½‘ç»œè¿æ¥æ­£å¸¸ï¼Œå¯è®¿é—® `mathematica.tsinghua.edu.cn`

---

**æœ€åæ›´æ–°:** 2026-02-11
**ç‰ˆæœ¬:** POMA 2.0
